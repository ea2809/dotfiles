"{{{ Virtualenv
let g:python3_host_prog=$HOME.'/venvs/nvim3/bin/python'
" }}}

"{{{ Change runtimepath
"Add the dotfiles folder to import lua files
let &runtimepath.=','.escape($HOME . '/dotfiles/vim', '\,')
" }}}

" Pre plug preferences {{{
let g:rooter_patterns = ['behave.ini', 'venv', '.in', '.git', '.git/', '_darcs/', '.hg/', '.bzr/', '.svn/', 'pom.xml', 'build.gradle' ]
" }}}

" Install plugins using vim-plug {{{
let plugfile = $HOME . '/dotfiles/vim/plug.vim'
if filereadable(plugfile)
  exec 'source' plugfile
endif
" }}}

" Keymaps are configured in vim/lua/keymaps.lua

" Base configuration {{{
set nocompatible

set clipboard=unnamed " Set clipboard

let maplocalleader = " "
let mapleader = " "

" enable syntax and plugins (for netrw)
syntax enable
filetype off
filetype plugin on

" Search down into subfolders
" Provides tab-completion for all file-related tasks
set path+=**

" Display all matching files when we tab complete
set wildmenu
set wildignore+=*/.git/*

set backspace=indent,eol,start

" Display problematic whitespace
" set listchars=tab:▸▹,trail:•,extends:#,precedes:#,nbsp:⌻
" set listchars=eol:¬,tab:>·,trail:~,extends:>,precedes:<,space:␣
set listchars=eol:¬,tab:»\ ,trail:~,extends:>,precedes:<,space:·
set list

" Show other match
set showmatch

" Display linebreaks and tabs
set linebreak
set showbreak=↪\ 
set breakindent
set tabstop=2
set showtabline=2
set softtabstop=2 " Width of a soft tab stop when using spaces
set shiftwidth=2  " Indent width

set cursorline

set visualbell " No sound

" Set up undo configuration
let vimDir = '$HOME/.vim'
if has('persistent_undo')
	" Set persistent undo
	let myUndoDir = expand(vimDir . '/undodir')
	set undofile
	set undodir=~/.vim/undo
	" Create dirs
	call system('mkdir -p ' . myUndoDir)
endif

" Set levels for history an undo
set history=1000
set undolevels=1000

" Activar las búsquedas
set hlsearch
set ignorecase
set smartcase

" Print when needed
" set lazyredraw 

set complete=.,w,b,u,t
set completeopt=longest,menuone

set smarttab

" Disable mode show
set noshowmode

" Show always the status
set laststatus=2

set number relativenumber

set termguicolors

set ttimeoutlen=50

set spelllang=es

" Auto reload files
set autoread

" Setup style
set background=dark
set t_Co=256  
let g:PaperColor_Theme_Options = {
			\   'theme': {
			\     'default': {
			\       'allow_bold': 1,
			\       'allow_italic': 1
			\     }
			\   }
			\ }
let g:gruvbox_material_background = 'hard'
let g:gruvbox_material_enable_italic = 1
" let g:gruvbox_material_disable_italic_comment = 1
let g:gruvbox_material_enable_bold = 1
let g:gruvbox_material_palette = 'original'
colorscheme gruvbox-material
" colorscheme PaperColor

" AirlineTheme dark
let g:airline_theme='dark'

" Telescope.nvim: {{{
hi! link TelescopeNormal GruvboxFg1
hi! link TelescopeSelection GruvboxOrangeBold
hi! link TelescopeSlectionCaret GruvboxRed
hi! link TelescopeMultiSelection GruvboxGray
hi! link TelescopeBorder TelescopeNormal
hi! link TelescopePromptBorder TelescopeNormal
hi! link TelescopeResultsBorder TelescopeNormal
hi! link TelescopePreviewBorder TelescopeNormal
hi! link TelescopeMatching GruvboxBlue
hi! link TelescopePromptPrefix GruvboxRed
hi! link TelescopePrompt TelescopeNormal

" }}}

" Netrw look like nerdtree
let g:netrw_banner = 0
" let g:netrw_liststyle = 3
let g:netrw_browse_split = 4
let g:netrw_altv = 1
let g:netrw_winsize = 20
let g:netrw_list_hide= '.*\.swp$,.*\.pyc'
let g:netrw_hide = 1
let g:netrw_fastbrowse = 0

" Views do not save options
" https://stackoverflow.com/questions/44065404/vim-does-not-reload-set-option-config-in-vimrc/44066065#44066065
set viewoptions-=options

" Save globals variables to save vim-workspace variable
set sessionoptions+=globals

" }}}

"Terminal thing {{{

"TODO: this is not working
let g:terminal_color_0 = '#222222'
let g:terminal_color8 = '#444444'
let g:terminal_color1 = '#ff000f'
let g:terminal_color9 = '#ff273f'
let g:terminal_color2 = '#8ce00a'
let g:terminal_color10 = '#abe05a'
let g:terminal_color3 = '#e3d000'
let g:terminal_color11 = '#ffff00'
let g:terminal_color4 = '#008df8'
let g:terminal_color12 = '#0092ff'
let g:terminal_color5 = '#6c43a5'
let g:terminal_color13 = '#9a5feb'
let g:terminal_color6 = '#00d7eb'
let g:terminal_color14 = '#67ffef'
let g:terminal_color7 = '#ffffff'
let g:terminal_color15 = '#ffffff'
" }}}

"Split/Save/Buffers mappings moved to vim/lua/keymaps.lua

" Prose mode found on the net {{{
function! ProseMode()
	call goyo#execute(0, [])
	set spell noci nosi noai nolist noshowmode noshowcmd
	set complete+=s
	"set bg=light
	"if !has('gui_running')
	"let g:solarized_termcolors=256
	"endif
	"colors solarized
endfunction

command! ProseMode call ProseMode()
" }}}

" Deople and UltiSnips config {{{
if has("nvim")
	" Enable deoplete at startup
	let g:deoplete#enable_at_startup = 1
	" let g:deoplete#omni_patterns = {}
	" let g:deoplete#omni_patterns.java = '[^. *\t]\.\w*'
	" let g:deoplete#sources = {}
	" let g:deoplete#sources._ = []
	" let g:deoplete#file#enable_buffer_path = 1	" Close preview window
	" autocmd InsertLeave,CompleteDone * if pumvisible() == 0 | pclose | endif
	" " Configure deoplete so that it uses tabs
	" let g:SuperTabDefaultCompletionType = "<C-n>"
	inoremap <expr><tab> pumvisible() ? "\<C-n>" : "\<tab>"

	let g:UltiSnipsExpandTrigger="<leader><tab>"
	let g:UltiSnipsJumpForwardTrigger="<leader>ss"
	let g:UltiSnipsJumpBackwardTrigger="<leader>sk"

	" UtilSnips
	nnoremap <leader>ss :call UltiSnips#JumpForwards()<CR>
	nnoremap <leader>sk :call UltiSnips#JumpBackwards()<CR>

endif
" }}}

" Vim airline configuration {{{
let g:airline_powerline_fonts = 1
let g:airline_right_alt_sep = ''
let g:airline_right_sep = ''
let g:airline_left_alt_sep= ''
let g:airline_left_sep = ''
let g:airline#extensions#tabline#enabled = 1

if !exists('g:airline_symbols')
	let g:airline_symbols = {}
endif

let g:airline_symbols.branch = ''
let g:airline_symbols.dirty = ' '
" }}}

" Language-specific ftplugin config lives under vim/after/ftplugin/*.lua

" Java {{{
" let g:neoformat_java_google = {
" 			\ 'exe': '/usr/local/bin/java-formatter',
" 			\ 'args': ["-"],
" 			\ 'stdin': 1, 
" 			\ }

" let g:neoformat_enabled_java = ['google']

" autocmd! BufWritePost,BufEnter *.java Neomake  " Linting
" autocmd FileType java setlocal tabstop=2 shiftwidth=2 expandtab

" }}}

" Scala {{{
" }}}

" Gui Setting {{{
if has('gui_macvim')
	set guifont=FuraCode\ Nerd\ Font:h13
	set linespace=2
	set macligatures
endif

" }}}

" CTRLP (FZF){{{

if executable('fzf')
	let g:ctrlp_map = '<m-p>'
	" noremap <silent> <C-p> :Files<CR>
endif

	" Using lua functions configured in vim/lua/keymaps.lua

""let g:ctrlp_mruf_relative = 1
"if executable('fd')
"	let g:ctrlp_user_command = 'fd --type f --color never "" %s'
"	let g:ctrlp_use_caching = 0
"elseif executable('rg')
"	let g:ctrlp_user_command = 'rg %s --files --color=never --glob ""'
"	let g:ctrlp_use_caching = 0
"elseif executable('ag')
"	let g:ctrlp_user_command = 'ag %s -i --nocolor --nogroup --hidden
"				\ --ignore .git
"				\ --ignore .svn
"				\ --ignore .hg
"				\ --ignore .DS_Store
"				\ --ignore "**/*.pyc"
"				\ --ignore "*.class"
"				\ -g ""'
"	let g:ctrlp_use_caching = 0
"else
"	let g:ctrlp_clear_cache_on_exit = 0
"endif
" }}}

" YAML/JSON filetype setup moved to vim/lua/autocmds.lua

" Cucumber {{{
" Thankts tpope for you awesome plugin: https://github.com/tpope/vim-cucumber
" }}}

" Neoformat {{{
let g:neoformat_only_msg_on_error = 1
let g:neoformat_clojure_zprint = {
      \ 'exe': '/opt/homebrew/bin/zprint',
      \ 'stdin': 1,
      \ }
let g:neoformat_clojurescript_zprint = {
      \ 'exe': '/opt/homebrew/bin/zprint',
      \ 'stdin': 1,
      \ }
let g:neoformat_clojurec_zprint = {
      \ 'exe': '/opt/homebrew/bin/zprint',
      \ 'stdin': 1,
      \ }
let g:neoformat_enabled_clojure = ['zprint']
let g:neoformat_enabled_clojurescript = ['zprint']
let g:neoformat_enabled_clojurec = ['zprint']
" augroup fmt
" 	autocmd!
" 	autocmd BufWritePre * undojoin | Neoformat
" augroup END

" }}}

" vim-workspace{{{
let g:workspace_session_directory = $HOME . '/.vim/sessions/'
let g:workspace_autosave = 0
let g:workspace_persist_undo_history = 0
let g:workspace_session_disable_on_args = 1
let g:workspace_autosave_ignore = ['gitcommit', 'help']
"}}}

" Rg (ripgrep) and Ag (Silver Searcher) {{{
if executable('rg')
	set grepprg=rg\ --vimgrep\ --no-heading
	command -nargs=+ -complete=file -bar Rgg silent! grep! <args>|cwindow|redraw!
	set grepformat=%f:%l:%c:%m,%f:%l:%m
endif

if executable('ag')
	" Use ag over grep
	set grepprg=ag\ --nogroup\ --nocolor
	command -nargs=+ -complete=file -bar Agg silent! grep! <args>|cwindow|redraw!
endif
" }}}

" LSP config{{{
command! LspAutoformatToggle lua require('lsp-setup').toggle_autoformat()
" }}}

" Markdown {{{
let g:vim_markdown_conceal = 0
let g:vim_markdown_conceal_code_blocks = 0
" }}}

" Netrw {{{
" Quit netrw when selecting a file
" function! QuitNetrw()
"   for i in range(1, bufnr("$"))
"     if buflisted(i)
"       if getbufvar(i, '&filetype') == "netrw"
"         exe 'bwipeout ' . i
"       endif
"     endif
"   endfor
" endfunction

" autocmd VimLeavePre *  call QuitNetrw()
" }}}

" Devicons config {{{
let g:WebDevIconsTabAirLineAfterGlyphPadding = ''
let g:WebDevIconsTabAirLineBeforeGlyphPadding = ' '
" }}}

" Behave Gherkin config {{{
let g:behave_path = ""
" }}}

" Abbrevations{{{
iabbrev pdbd import sys, pdb; pdb.Pdb(stdout=sys.__stdout__).set_trace()
" }}}

" Scrolling {{{
" Note: is sidescrolloff is modifies should be modified in the Terminal Config
" section
set scrolljump=5      " Lines to scroll when cursor leaves screen
set scrolloff=8       " Minimum lines to keep above and below cursor
set sidescrolloff=15  " Minimum columns to keep left and right of cursor
set sidescroll=1      " Number of columns to scroll horizontally
" }}}

" Syntax {{{

" JAVA
highlight link JavaIdentifier Identifier
highlight link JavaOperator Operator

highlight link JavaFunction Function
highlight link JavaFunctionCall Function
highlight link javaInclude Include
highlight link javaOverride Identifier
highlight link javaPackage Include
highlight link javaSpecialTags PreProc
highlight link javaPreProc PreProc
highlight link javaTypedef Type
highlight link javaTypeIn Type
highlight link javaTypeSystem Type
highlight link javaOperatorSystem Operator
highlight link javaOperatorSpecial Operator


" Cucumber
hi! def link cucumberGiven     Include

command! SynStack call <SID>SynStack()

function! s:SynStack()
    if exists("*synstack")
        for id in synstack(line("."), col("."))
            echon " ".synIDattr(id, "name")
            exe "echoh ".synIDattr(id, "name")
            echon "[".synIDattr(synIDtrans(id), "name")."]"
            echoh None
        endfor
    endif
endfunc 

"Fix gitgutter
highlight! link SignColumn LineNr

" Enable Rainbow
let g:rainbow_conf = {
			\	'guifgs': ['royalblue3', 'darkorange3', 'seagreen3', 'firebrick'],
			\	'ctermfgs': ['lightblue', 'lightyellow', 'lightcyan', 'lightmagenta'],
			\	'guis': [''],
			\	'cterms': [''],
			\	'operators': '',
			\	'parentheses': ['start=/(/ end=/)/ fold', 'start=/\[/ end=/\]/ fold', 'start=/{/ end=/}/ fold', 'start=/</ end=/>/ fold'],
			\}
let g:rainbow_active = 1

"}}}

" GutenTags {{{
let g:gutentags_exclude_filetypes = ['gitcommit', 'gitconfig', 'gitrebase', 'gitsendemail', 'git']
" }}}

" Lua files {{{
lua require('tree-sitter')
lua require('which-key-local')
lua require('bufferline-setup')
lua require('lualine-setup')
lua require('mini-setup')
lua require('ident_line-setup')
lua require('local-fzf')
lua require('mason-tools-setup')
lua require('lsp-setup')
lua require('dap-setup')
lua require('autocmds')
lua require('keymaps')
lua require('project-local').setup()
"}}}

" Quick-Scope {{{
let g:qs_highlight_on_keys = ['f', 'F', 't', 'T']
"}}}

" Vista {{{
let g:vista#renderer#enable_icon = 1
"}}}

" cwjk"rpb"ryiwn@a
